<?php

/**
 * DealerWorkStatistic
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    Servicepool2.0
 * @subpackage model
 * @author     Your name here
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class DealerWorkStatistic extends BaseDealerWorkStatistic
{
    private $_models_count = 0;
    private $_models_summ = 0;
    private $_total_activities = 0;
    private $_total_activities_with_statistic = 0;
    private $_total_activities_without_statistic = 0;

    public function loadData() {
        $this->_models_count = DealerWorkStatisticModelsTable::getInstance()->createQuery()->where('parent_id = ?', $this->getId())->count();

        if ($this->_models_count > 0) {
            $q = Doctrine_Query::create()
                ->select('sum(t.model_cost)')
                ->from('DealerWorkStatisticModels t')
                ->where('t.parent_id = ?', $this->getId());

            $res = $q->execute(array(), Doctrine_Core::HYDRATE_SCALAR);

            if (isset($res)) {
                $this->_models_summ = $res[0]['t_sum'];
            }
        }

        $this->_total_activities = DealerWorkStatisticActivitiesTable::getInstance()->createQuery()->where('parent_id = ?', $this->getId())->count();

        $this->_total_activities_with_statistic = DealerWorkStatisticActivitiesTable::getInstance()->createQuery()
            ->where('parent_id = ? and statistic_complete = ?', array($this->getId(), Activity::STATISTIC_COMPLETED))->count();

        $this->_total_activities_without_statistic = DealerWorkStatisticActivitiesTable::getInstance()->createQuery()
            ->where('parent_id = ? and statistic_complete = ?', array($this->getId(), Activity::STATISTIC_NOT_COMPLETED))->count();

        return $this;
    }

    public function getTotalModels() {
        return $this->_models_count;
    }

    public function getTotalModelsSum() {
        return $this->_models_summ;
    }

    public function getTotalActivities() {
        return $this->_total_activities;
    }

    public function getTotalActivitiesWithCompleteStatistic() {
        return $this->_total_activities_with_statistic;
    }

    public function getTotalActivitiesWithoutCompleteStatistic() {
        return $this->_total_activities_without_statistic;
    }
}
