<?php

/**
 * ActivityVideoRecordsStatisticsHeaders
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    Servicepool2.0
 * @subpackage model
 * @author     Your name here
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class ActivityVideoRecordsStatisticsHeaders extends BaseActivityVideoRecordsStatisticsHeaders
{
    public function __toString()
    {
        $parent_obj = ActivityVideoRecordsStatisticsTable::getInstance()->find($this->getParentId());

        return sprintf
        (
            '%s (%s)',
            $this->getHeader(),
            $parent_obj ? $parent_obj->getHeader() : 'Нет'
        );
    }

    public function getGroupList() {
        return ActivityVideoRecordsStatisticsHeadersGroupsTable::getInstance()->createQuery()->where('parent_header_id = ?', $this->getId())->execute();
    }

    public function getFieldsList($groups_list = null) {
        $groups_keys = array();

        if (!is_null($groups_list)) {
            foreach ($groups_list as $group) {
                $groups_keys[] = $group->getId();
            }
        }

        return ActivityFieldsTable::getInstance()
            ->createQuery()
            ->where('parent_header_id = ? and owner = ?', array($this->getId(), 0))
            ->andWhereNotIn('group_id', $groups_keys)
            ->orderBy('position ASC')
            ->execute();
    }


}
