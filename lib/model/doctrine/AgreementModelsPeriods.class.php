<?php

/**
 * AgreementModelsPeriods
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    Servicepool2.0
 * @subpackage model
 * @author     Your name here
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class AgreementModelsPeriods extends BaseAgreementModelsPeriods
{
    const STATUS_COMMENTED = 'commented';
    const STATUS_COMMENTED_BY_SPECIALIST = 'commented_by_specialist';
    const STATUS_SENDED = 'sended';
    const STATUS_COMPLETED = 'completed';

    public function getCommentModelsCount()
    {
        return $this->getModelsCountByStatus(self::STATUS_COMMENTED);
    }

    public function getCommentBySpecialistModelsCount()
    {
        return $this->getModelsCountByStatus(self::STATUS_COMMENTED_BY_SPECIALIST, true);
    }

    public function getSendedModelsCount()
    {
        return $this->getModelsCountByStatus(self::STATUS_SENDED);
    }

    public function getCompletedModelsCount()
    {
        return $this->getModelsCountByStatus(self::STATUS_COMPLETED);
    }

    private function getModelsCountByStatus($status, $group_by_model = false)
    {
        $query = AgreementModelsPeriodsStatsTable::getInstance()
                ->createQuery()
                ->where('model_period_id = ? and model_status = ?',
                    array(
                        $this->getId(),
                        $status
                    )
                );

        if ($group_by_model) {
            $query->groupBy('model_id');
        }

        return $query->count();
    }

    public function getItemsListByStatus($status)
    {
        $result = array();
        $items = AgreementModelsPeriodsStatsTable::getInstance()
            ->createQuery()
            ->select('model_id')
            ->where('model_period_id = ? and model_status = ?',
                array(
                    $this->getId(),
                    $status
                )
            )
            ->execute(array(), Doctrine_Core::HYDRATE_ARRAY);

        foreach($items as $item) {
            $result[] = $item['model_id'];
        }

        return $result;
    }
}
