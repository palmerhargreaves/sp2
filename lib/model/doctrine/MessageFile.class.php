<?php

/**
 * MessageFile
 *
 * This class has been auto-generated by the Doctrine ORM Framework
 *
 * @package    Servicepool2.0
 * @subpackage model
 * @author     Your name here
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class MessageFile extends BaseMessageFile
{
    const FILE_PATH = 'messages/file';

    function setUp()
    {
        parent::setUp();

        $this->addListener(new UploadHelper('file', self::FILE_PATH));
    }

    function applyTemp(TempFile $temp)
    {
        $generator = new UniqueFileNameGenerator(sfConfig::get('sf_upload_dir') . '/' . self::FILE_PATH);
        $this->setFile($generator->generate($temp->getFile()));
        $temp->apply(sfConfig::get('sf_upload_dir') . '/' . self::FILE_PATH . '/' . $this->getFile());
    }

    /**
     * Returns a file name helper
     *
     * @return FileNameHelper
     */
    function getFileNameHelper()
    {
        $path = $this->getPath();
        if (!empty($path)) {
            return new FileNameHelper(sfConfig::get('sf_upload_dir') . '/' . self::FILE_PATH . '/' . $this->getFileName());
        }

        return new FileNameHelper(sfConfig::get('sf_upload_dir') . '/' . self::FILE_PATH . '/' . $this->getFile());
    }

    public function getFileName() {
        $path = $this->getPath();

        if (!empty($path) && !is_null($path)) {
            return sprintf('%s/%s', $path, $this->getFile());
        }

        return $this->getFile();
    }
}
