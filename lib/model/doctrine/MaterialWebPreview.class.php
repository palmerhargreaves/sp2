<?php

/**
 * MaterialWebPreview
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    Servicepool2.0
 * @subpackage model
 * @author     Your name here
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class MaterialWebPreview extends BaseMaterialWebPreview
{
  const FILE_PATH = 'materials/web_preview';
  const SERVER_FILES_PATH = 'uploads_raw/materials/web_preview';
  
  function setUp()
  {
    parent::setUp();
    
    $this->addListener(new UploadHelper('file', self::FILE_PATH));
  }
  
  function setupFile($path, $file)
  {
    require_once sfConfig::get('sf_lib_dir').'/vendor/phpthumb/ThumbLib.inc.php';
    
    $thumb = PhpThumbFactory::create($path.'/'.$file);
    $thumb->resize(143, 129);
    $thumb->save($path.'/preview/'.$file);
  }
  
  function isLandscape() 
  {
    $size = getimagesize(sfConfig::get('sf_upload_dir').'/'.self::FILE_PATH.'/preview/'.$this->getFile());
    
    return $size && $size[0] > $size[1];
  }
  
  function setFromServerFile($file)
  {
    $src = sfConfig::get('sf_upload_dir').'/'.self::SERVER_FILES_PATH.'/'.$file;
    $name_generator = new UniqueFileNameGenerator(sfConfig::get('sf_upload_dir').'/'.self::FILE_PATH);
    $dst = $name_generator->getPath().'/'.$name_generator->generate($file);
    
    rename($src, $dst);
    
    $this->setFile(basename($dst));
  }
  
  function deleteFile($path, $file)
  {
    @unlink($path.'/preview/'.$file);
  }
}